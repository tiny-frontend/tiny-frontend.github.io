<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="generator" content="VuePress 2.0.0-beta.35">
  <style>
      :root {
          --c-bg: #fff;
      }
      html.dark {
          --c-bg: #22272e;
      }
      html, body {
          background-color: var(--c-bg);
      }
  </style>
  <script>
    const userMode = localStorage.getItem('vuepress-color-scheme');
    const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
      document.documentElement.classList.toggle('dark', true);
    }
  </script>
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="manifest" href="/manifest.webmanifest"><meta name="application-name" content="tiny frontend"><meta name="apple-mobile-web-app-title" content="tiny frontend"><meta name="apple-mobile-web-app-status-bar-style" content="black"><title>Architecture | tiny frontend</title><meta name="description" content="Example micro frontend architecture">
  <link rel="modulepreload" href="/assets/app.ee617076.js"><link rel="modulepreload" href="/assets/architecture.html.3d58b7bd.js"><link rel="modulepreload" href="/assets/architecture.html.9000ed9d.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js">
  <link rel="stylesheet" href="/assets/style.b0ff7f2b.css">
</head>
<body>
<div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/images/logo.png" alt="tiny frontend"><span class="site-name can-hide">tiny frontend</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/tiny-frontend" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/tiny-frontend" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/guide/about.html" class="sidebar-item sidebar-heading" aria-label="About tiny frontend"><!--[--><!--]--> About tiny frontend <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/architecture.html" class="router-link-active router-link-exact-active router-link-active sidebar-item sidebar-heading active" aria-label="Architecture"><!--[--><!--]--> Architecture <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/guide/architecture.html#overview" class="router-link-active router-link-exact-active sidebar-item" aria-label="Overview"><!--[--><!--]--> Overview <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/architecture.html#example-tiny-frontend" class="router-link-active router-link-exact-active sidebar-item" aria-label="Example Tiny Frontend"><!--[--><!--]--> Example Tiny Frontend <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/guide/architecture.html#app" class="router-link-active router-link-exact-active sidebar-item" aria-label="app"><!--[--><!--]--> app <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/architecture.html#contract" class="router-link-active router-link-exact-active sidebar-item" aria-label="contract"><!--[--><!--]--> contract <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/guide/architecture.html#api-cloudflare" class="router-link-active router-link-exact-active sidebar-item" aria-label="Api Cloudflare"><!--[--><!--]--> Api Cloudflare <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/guide/architecture.html#api" class="router-link-active router-link-exact-active sidebar-item" aria-label="api"><!--[--><!--]--> api <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/architecture.html#deploy" class="router-link-active router-link-exact-active sidebar-item" aria-label="deploy"><!--[--><!--]--> deploy <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/guide/architecture.html#tiny-client" class="router-link-active router-link-exact-active sidebar-item" aria-label="Tiny Client"><!--[--><!--]--> Tiny Client <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/guide/architecture.html#client-side-only" class="router-link-active router-link-exact-active sidebar-item" aria-label="Client side only"><!--[--><!--]--> Client side only <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/architecture.html#server-side-ssr-with-client-side-rehydration" class="router-link-active router-link-exact-active sidebar-item" aria-label="Server side (SSR) with client side rehydration"><!--[--><!--]--> Server side (SSR) with client side rehydration <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/architecture.html#cache-and-retry-policy" class="router-link-active router-link-exact-active sidebar-item" aria-label="Cache and Retry Policy"><!--[--><!--]--> Cache and Retry Policy <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/guide/architecture.html#example-hosts" class="router-link-active router-link-exact-active sidebar-item" aria-label="Example Hosts"><!--[--><!--]--> Example Hosts <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/guide/architecture.html#remix" class="router-link-active router-link-exact-active sidebar-item" aria-label="Remix"><!--[--><!--]--> Remix <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/architecture.html#next-js" class="router-link-active router-link-exact-active sidebar-item" aria-label="Next.js"><!--[--><!--]--> Next.js <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/guide/architecture.html#current-known-limitations" class="router-link-active router-link-exact-active sidebar-item" aria-label="Current known limitations"><!--[--><!--]--> Current known limitations <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/guide/deploy.html" class="sidebar-item sidebar-heading" aria-label="Deploy your own"><!--[--><!--]--> Deploy your own <!--[--><!--]--></a><!----></li><li><a class="external-link sidebar-item sidebar-heading" href="https://tiny-frontend-example-host-remix.fly.dev/" rel="noopener noreferrer" target="_blank" aria-label="Example Remix host"><!--[--><!--]--> Example Remix host <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a><!----></li><li><a class="external-link sidebar-item sidebar-heading" href="https://example-host-nextjs.vercel.app/" rel="noopener noreferrer" target="_blank" aria-label="Example Next.js host"><!--[--><!--]--> Example Next.js host <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="architecture" tabindex="-1"><a class="header-anchor" href="#architecture" aria-hidden="true">#</a> Architecture</h1><h2 id="overview" tabindex="-1"><a class="header-anchor" href="#overview" aria-hidden="true">#</a> Overview</h2><p>Here is a diagram of the general architecture:</p><p><img src="/images/docs/general-architecture.jpg" alt="General architecture diagram"></p><p>Each pink box is a GitHub repository. There are four of them:</p><ul><li><a href="https://github.com/tiny-frontend/example-tiny-frontend" target="_blank" rel="noopener noreferrer">example tiny frontend<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>: A simple micro frontend to be deployed and consumed</li><li><a href="https://github.com/tiny-frontend/api-cloudflare" target="_blank" rel="noopener noreferrer">api-cloudflare<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>: an API using Cloudflare Workers where the latest bundle for that micro frontend is deployed</li><li>Example host: <ul><li><a href="https://github.com/tiny-frontend/example-host-remix-node" target="_blank" rel="noopener noreferrer">example-host-remix-node<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>: An example Remix app consuming that micro frontend</li><li><a href="https://github.com/tiny-frontend/example-host-nextjs" target="_blank" rel="noopener noreferrer">example-host-nextjs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>: An example Next.js app consuming that micro frontend</li></ul></li><li><a href="https://github.com/tiny-frontend/tiny-client" target="_blank" rel="noopener noreferrer">tiny-client<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>: A small library to consume the micro frontend at runtime</li></ul><h2 id="example-tiny-frontend" tabindex="-1"><a class="header-anchor" href="#example-tiny-frontend" aria-hidden="true">#</a> Example Tiny Frontend</h2><p>This is the code of the micro frontend you want to use in a host app. It has two folders:</p><ul><li><code>app</code></li><li><code>contract</code></li></ul><h3 id="app" tabindex="-1"><a class="header-anchor" href="#app" aria-hidden="true">#</a> <code>app</code></h3><p>The app is the source of the component you want to expose. In this case it exposes a component called <code>ExampleTinyFrontend</code>.</p><p>It&#39;s bundled as a JavaScript <code>UMD</code> bundle, and a CSS bundle using <a href="https://vitejs.dev/guide/build.html#library-mode" target="_blank" rel="noopener noreferrer">Vite library mode<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. <code>React</code> is marked as external for the build. It will be provided by the host.</p><p>Both bundles are then deployed to the Api Cloudflare to be consumed by the host.</p><h3 id="contract" tabindex="-1"><a class="header-anchor" href="#contract" aria-hidden="true">#</a> <code>contract</code></h3><p>The contract is a regular npm package. It contains:</p><ul><li>The TypeScript type for <code>ExampleTinyFrontend</code></li><li>Two functions to consume the latest deployed <code>app</code> at runtime: <ul><li><code>loadExampleTinyFrontendServer</code> to be used on SSR</li><li><code>loadExampleTinyFrontendClient</code> to be used client side</li></ul></li><li>Peer dependencies (in this case <code>React</code>)</li></ul><p>This package will pull the latest deployed <code>app</code> bundle at runtime from the <code>api</code>.</p><h2 id="api-cloudflare" tabindex="-1"><a class="header-anchor" href="#api-cloudflare" aria-hidden="true">#</a> Api Cloudflare</h2><p>This is an example implementation of a tiny frontend api using <a href="https://workers.cloudflare.com/" target="_blank" rel="noopener noreferrer">Cloudflare Workers<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> and <a href="https://www.cloudflare.com/products/workers-kv/" target="_blank" rel="noopener noreferrer">KV<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><p>The repository has two folders:</p><ul><li><code>api</code></li><li><code>deploy</code></li></ul><h3 id="api" tabindex="-1"><a class="header-anchor" href="#api" aria-hidden="true">#</a> <code>api</code></h3><p>A tiny frontend api must have the two following endpoints:</p><ul><li><code>/tiny/latest/{tinyFrontendName}/{contractVersion}</code> should respond with:</li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;umdBundle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tinyFrontend-umd-bundle-name.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;cssBundle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tinyFrontend-css-bundle-name.css&quot;</span> <span class="token comment">// Optional</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>/tiny/bundle/{bundleName}</code> should respond with the source of the bundle with <code>bundleName</code>.</li></ul><p>In the case of this Cloudflare implementation, we use KV to store the source of the latest bundles and serves them at runtime.</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>You could write this API with whatever stack you want. As long as you have the correct endpoints, and a way of deploying bundles to it, it would work.</p></div><h3 id="deploy" tabindex="-1"><a class="header-anchor" href="#deploy" aria-hidden="true">#</a> <code>deploy</code></h3><p>A simple npm package that can be used to deploy a bundle to <code>api</code>. It&#39;s used by the <a href="https://github.com/tiny-frontend/example-tiny-frontend/blob/main/app/deploy/deploy.js#L19" target="_blank" rel="noopener noreferrer">Example Tiny Frontend <code>app</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> to deploy its bundle.</p><p>It exposes the following function:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">deployBundle</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  cloudflare<span class="token punctuation">,</span> <span class="token comment">// Cloudflare credentials</span>
  name<span class="token punctuation">,</span> <span class="token comment">// Name of the tiny frontend to deploy</span>
  contractVersion<span class="token punctuation">,</span> <span class="token comment">// Version of the contract to deploy for</span>
  umdBundlePath<span class="token punctuation">,</span> <span class="token comment">// Path of the JS UMD bundle on disk</span>
  cssBundlePath<span class="token punctuation">,</span> <span class="token comment">// Path of the CSS bundle on disk</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>When you call this method it uses the <a href="https://api.cloudflare.com/#workers-kv-namespace-write-key-value-pair" target="_blank" rel="noopener noreferrer">Cloudflare API<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> to push the JS UMD and CSS bundles source to KV.</p><h2 id="tiny-client" tabindex="-1"><a class="header-anchor" href="#tiny-client" aria-hidden="true">#</a> Tiny Client</h2><p>This is where the magic happens ✨ ! This package can fetch and evaluate a tiny frontend at runtime either client or server side.</p><p>The <strong>main steps</strong> it always follows are:</p><ul><li>Call a <code>tiny-api</code> to fetch the name of the latest UMD and CSS bundles.</li><li>Fetch the latest UMD JS bundle source.</li><li>Evaluate the UMD bundle source while providing dependencies to it.</li><li>Return a reference to the component(s) exported by the UMD JS bundle.</li></ul><h3 id="client-side-only" tabindex="-1"><a class="header-anchor" href="#client-side-only" aria-hidden="true">#</a> Client side only</h3><p>The <strong>main steps</strong> above will happen first. Then, if there is a CSS bundle, it will create a <code>link</code> to that CSS file.</p><h3 id="server-side-ssr-with-client-side-rehydration" tabindex="-1"><a class="header-anchor" href="#server-side-ssr-with-client-side-rehydration" aria-hidden="true">#</a> Server side (SSR) with client side rehydration</h3><p>The server side loading function executes the <strong>main steps</strong> above.</p><p>It also returns a piece of HTML to be added to the SSR result. This piece of HTML will:</p><ul><li>Add a <code>link preload</code> to the UMD JS bundle.</li><li>Add a <code>link</code> to the CSS bundle.</li><li>Expose the config fetched from the <code>tiny-api</code> on window to make sure both client and server will use the same bundle.</li></ul><p>Once on the client side, before calling <code>ReactDOM.hydrate</code>, you need to call <code>loadTinyFrontendClient</code>. This will load and evaluate the UMD bundle based on the config exposed on window.</p><p>Then, when <code>React</code> will rehydrate the page, your tiny frontend will already be loaded and the component will get rehydrated ✨ !</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>Loading a tiny frontend on server side requires an environment that support runtime JS source evaluation (<code>new Function(source)</code>).</p><p>This is currently <a href="https://developers.cloudflare.com/workers/runtime-apis/web-standards#javascript-standards" target="_blank" rel="noopener noreferrer">not supported on Cloudflare Workers<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> (for security reason), therefore this won&#39;t work if you deploy your host apps to that platform.</p><p>You can however still use the client side only version in that case.</p></div><h3 id="cache-and-retry-policy" tabindex="-1"><a class="header-anchor" href="#cache-and-retry-policy" aria-hidden="true">#</a> Cache and Retry Policy</h3><p>Both <code>loadTinyFrontendClient</code> and <code>loadTinyFrontendServer</code> accept some <code>LoadingOptions</code>.</p><h4 id="cachettlinms" tabindex="-1"><a class="header-anchor" href="#cachettlinms" aria-hidden="true">#</a> <code>cacheTtlInMs</code></h4><p>By default, tiny frontend will cache the latest fetched bundle in memory for 2 minutes. This means that for 2 minutes, all calls to <code>loadTinyFrontendClient</code> or <code>loadTinyFrontendServer</code> will return the same bundle even if there is a newer bundle deployed.</p><p>There is a compromise to be had between speed of response, and speed of reflecting changes when new bundle are deployed.</p><p>If you wish to change that behaviour you can pass the <code>cacheTtlInMs</code> loading option to alter it:</p><ul><li>Passing <code>null</code> or <code>undefined</code> will cache for as long as your server is running and never fetch again.</li><li>Passing <code>0</code> will disable the cache (we will fetch the latest configuration for each request)</li><li>Passing any other number <code>X</code> will result in reusing the bundle in memory if it has been fetched less than <code>X</code> milliseconds ago.</li></ul><h4 id="retrypolicy" tabindex="-1"><a class="header-anchor" href="#retrypolicy" aria-hidden="true">#</a> <code>retryPolicy</code></h4><p>By default, tiny frontend won&#39;t retry if there is an error fetching either the name of the latest bundle from the API or its content, and just throw.</p><p>If you want tiny frontend to automatically retry in case of errors, you can pass <code>retryPolicy</code> to the loading options:</p><ul><li><code>retryPolicy.maxRetries</code> maximum number of retries after the first failure (defaults to <code>0</code>).</li><li><code>retryPolicy.delayInMs</code> delay between each retries in milliseconds. The delay will be doubled between each tried. For example for a delay of <code>100ms</code> and <code>3 retries</code>, it will do: <ul><li>Try once, <strong>fails</strong>. <em>Wait 100ms.</em></li><li>First retry, <strong>fails</strong>. <em>Wait 200ms</em></li><li>Second retry, <strong>fails</strong>. <em>Wait 400ms</em></li><li>Third retry, <strong>fails</strong>. <em>Give up and throw error.</em></li></ul></li></ul><h2 id="example-hosts" tabindex="-1"><a class="header-anchor" href="#example-hosts" aria-hidden="true">#</a> Example Hosts</h2><p>There are two example hosts:</p><ul><li>A <a href="https://github.com/tiny-frontend/example-host-remix-node" target="_blank" rel="noopener noreferrer">Remix app<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> deployed on <a href="https://fly.io/" target="_blank" rel="noopener noreferrer">Fly.io<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>A <a href="https://github.com/tiny-frontend/example-host-nextjs" target="_blank" rel="noopener noreferrer">Next.js app<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> deployed on <a href="https://vercel.com/" target="_blank" rel="noopener noreferrer">Vercel<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><p>They both have the Example Tiny Frontend <code>contract</code> as an npm dependency.</p><p>As everything is better explained with a meme:</p><p style="text-align:center;"><img alt="" src="/images/docs/consume-tiny-fe-meme.jpg" width="450"></p><h3 id="remix" tabindex="-1"><a class="header-anchor" href="#remix" aria-hidden="true">#</a> Remix</h3><h4 id="client-side-only-1" tabindex="-1"><a class="header-anchor" href="#client-side-only-1" aria-hidden="true">#</a> Client side only</h4><p>To consume the example tiny frontend on client side, <a href="https://github.com/tiny-frontend/example-host-remix-node/blob/main/app/routes/client-side-only.tsx#L25" target="_blank" rel="noopener noreferrer">we simply load it in a <code>useEffect</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> by calling <code>loadExampleTinyFrontendClient</code> and passing the URL of our <code>tiny-api</code>.</p><p>While the tiny frontend is loading, we show a <code>Loading...</code> label.</p><p>When the tiny frontend is loaded, we set the component we receive in a <code>useState</code>. We then simply renders it like any other <code>React</code> component 🐰 .</p><h4 id="server-side-ssr-with-client-side-rehydration-1" tabindex="-1"><a class="header-anchor" href="#server-side-ssr-with-client-side-rehydration-1" aria-hidden="true">#</a> Server side (SSR) with client side rehydration</h4><p>This is a bit more involved, but still rather straightforward.</p><h5 id="on-the-server" tabindex="-1"><a class="header-anchor" href="#on-the-server" aria-hidden="true">#</a> On the server</h5><p>In <a href="https://github.com/tiny-frontend/example-host-remix-node/blob/main/app/entry.server.tsx#L13" target="_blank" rel="noopener noreferrer"><code>entry.server.ts</code> we load the tiny frontend<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> by calling <code>loadExampleTinyFrontendServer</code> before rendering happens.</p><p>We then <a href="https://github.com/tiny-frontend/example-host-remix-node/blob/main/app/routes/ssr.tsx#L10" target="_blank" rel="noopener noreferrer">use the server side loaded component in our Remix route<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><p>In <a href="https://github.com/tiny-frontend/example-host-remix-node/blob/main/app/root.tsx#L32" target="_blank" rel="noopener noreferrer"><code>root.ts</code> while on server we add a <code>__TINY_FRONTEND_SSR__</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> label. (It&#39;s a similar approach taken for <a href="https://remix.run/docs/en/v1/guides/styling#css-in-js-libraries" target="_blank" rel="noopener noreferrer">Styled Components with Remix<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.)</p><p>Finally, once we rendered, <a href="https://github.com/tiny-frontend/example-host-remix-node/blob/main/app/entry.server.tsx#L24" target="_blank" rel="noopener noreferrer">we replace <code>__TINY_FRONTEND_SSR__</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> in the output HTML string with whatever was returned by <code>loadExampleTinyFrontendServer</code>.</p><p>Our Remix app is now loading that tiny frontend on the server and rendering it ✨! Let&#39;s see what we need to add to be able to rehydrate.</p><h5 id="on-the-client" tabindex="-1"><a class="header-anchor" href="#on-the-client" aria-hidden="true">#</a> On the client</h5><p>In <a href="https://github.com/tiny-frontend/example-host-remix-node/blob/main/app/entry.client.tsx#L6" target="_blank" rel="noopener noreferrer"><code>entry.client.ts</code> we load the tiny frontend<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> by calling <code>loadExampleTinyFrontendClient</code> before rehydration.</p><p>We then <a href="https://github.com/tiny-frontend/example-host-remix-node/blob/main/app/routes/ssr.tsx#L10" target="_blank" rel="noopener noreferrer">use the client side loaded component in our Remix route<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><p>And... That&#39;s it, we now have <strong>fully working, independently deployed frontend component, with SSR and rehydration</strong> 😱 !</p><h3 id="next-js" tabindex="-1"><a class="header-anchor" href="#next-js" aria-hidden="true">#</a> Next.js</h3><h4 id="client-side-only-2" tabindex="-1"><a class="header-anchor" href="#client-side-only-2" aria-hidden="true">#</a> Client side only</h4><p>To consume the example tiny frontend on client side, <a href="https://github.com/tiny-frontend/example-host-nextjs/blob/main/pages/client-side-only.tsx#L27" target="_blank" rel="noopener noreferrer">we simply load it in a <code>useEffect</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> by calling <code>loadExampleTinyFrontendClient</code> and passing the URL of our <code>tiny-api</code>.</p><p>While the tiny frontend is loading, we show a <code>Loading...</code> label.</p><p>When the tiny frontend is loaded, we set the component we receive in a <code>useState</code>. We then simply renders it like any other <code>React</code> component 🐰 .</p><h4 id="server-side-ssr-with-client-side-rehydration-2" tabindex="-1"><a class="header-anchor" href="#server-side-ssr-with-client-side-rehydration-2" aria-hidden="true">#</a> Server side (SSR) with client side rehydration</h4><p>This is a bit more involved, but still rather straightforward.</p><h5 id="on-the-server-1" tabindex="-1"><a class="header-anchor" href="#on-the-server-1" aria-hidden="true">#</a> On the server</h5><p>In <a href="https://github.com/tiny-frontend/example-host-nextjs/blob/main/pages/_document.tsx#L61" target="_blank" rel="noopener noreferrer"><code>_document.ts</code> we load the tiny frontend<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> by calling <code>loadExampleTinyFrontendServer</code> before rendering happens. We also inject the JS and CSS script tags for the Tiny Frontend <a href="https://github.com/tiny-frontend/example-host-nextjs/blob/main/pages/_document.tsx#L28" target="_blank" rel="noopener noreferrer">in the document head<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><p>We then <a href="https://github.com/tiny-frontend/example-host-nextjs/blob/main/pages/ssr.tsx#L11" target="_blank" rel="noopener noreferrer">use the server side loaded component in our Next.js page<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><p>Our Next.js app is now loading that tiny frontend on the server and rendering it ✨! Let&#39;s see what we need to add to be able to rehydrate.</p><h5 id="on-the-client-1" tabindex="-1"><a class="header-anchor" href="#on-the-client-1" aria-hidden="true">#</a> On the client</h5><p>We create <a href="https://github.com/tiny-frontend/example-host-nextjs/blob/main/components/ExampleTinyFrontend/ExampleTinyFrontend.client.tsx#L9" target="_blank" rel="noopener noreferrer">a client side version of our component<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> that can load itself on the client and suppresses hydration warnings using the <a href="https://github.com/tiny-frontend/tiny-client-react/blob/main/src/withHydrationSuppress.tsx#L16" target="_blank" rel="noopener noreferrer"><code>withHydrationSuppress</code> HOC<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. This uses the same technique as <a href="https://www.npmjs.com/package/react-lazy-hydration" target="_blank" rel="noopener noreferrer">react-lazy-hydration<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><p>We then <a href="https://github.com/tiny-frontend/example-host-nextjs/blob/main/pages/ssr.tsx#L11" target="_blank" rel="noopener noreferrer">use the client side component in our Next.js page<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> when the Server side component is undefined.</p><p>And... That&#39;s it, we now have <strong>fully working, independently deployed frontend component, with SSR and rehydration</strong> 😱 !</p><h2 id="current-known-limitations" tabindex="-1"><a class="header-anchor" href="#current-known-limitations" aria-hidden="true">#</a> Current known limitations</h2><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Below is a list of limitations <strong>I&#39;m currently aware of</strong> with the example hosts. Contributions are welcome to help solve them, or to add new limitations to the list 😉 .</p></div><h4 id="🔁-the-tiny-frontend-is-loaded-on-every-request" tabindex="-1"><a class="header-anchor" href="#🔁-the-tiny-frontend-is-loaded-on-every-request" aria-hidden="true">#</a> 🔁  The tiny frontend is loaded on every request</h4><p>This one is easily overcome. You could implement a simple server side cache, and refresh the tiny frontend in the background every <code>X</code> minutes for example. We just haven&#39;t done it in this example.</p><h4 id="🗑-the-tiny-frontend-is-loaded-for-every-route-no-matter-if-it-used-or-not" tabindex="-1"><a class="header-anchor" href="#🗑-the-tiny-frontend-is-loaded-for-every-route-no-matter-if-it-used-or-not" aria-hidden="true">#</a> 🗑  The tiny frontend is loaded for every route, no matter if it used or not</h4><p>This could potentially be fixed with a more involved implementation. We could for example imagine &quot;collecting&quot; rendered components on server on a route, and only loading those before client rehydration.</p><p>However, that solution probably would require some new hooks in Remix or Next.js, for example async client side route transitions guards.</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>This could also be solved using <a href="https://github.com/reactwg/react-18/discussions/37" target="_blank" rel="noopener noreferrer">Suspense for data fetching on SSR<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> in React 18, as a tiny frontend could be loaded as part of a Suspense boundary when a given route is rendered.</p></div><h4 id="💿-the-tiny-frontend-can-t-load-its-own-data-before-ssr" tabindex="-1"><a class="header-anchor" href="#💿-the-tiny-frontend-can-t-load-its-own-data-before-ssr" aria-hidden="true">#</a> 💿  The tiny frontend can&#39;t load its own data before SSR</h4><p>The tiny frontend might be able to provide some kind of data loader, but again this might require some hooks in Remix or Next.js to call them at the right time.</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Once again <a href="https://github.com/reactwg/react-18/discussions/37" target="_blank" rel="noopener noreferrer">Suspense for data fetching on SSR<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> in React 18 could save us here, as a tiny frontend could use its own Suspense boundary to load its data when it&#39;s rendered.</p></div><h4 id="🚏-the-tiny-frontend-can-t-declare-its-own-routes" tabindex="-1"><a class="header-anchor" href="#🚏-the-tiny-frontend-can-t-declare-its-own-routes" aria-hidden="true">#</a> 🚏  The tiny frontend can&#39;t declare its own routes</h4><p>As stated in the: <a href="/guide/about.html#%F0%9F%99%85%E2%80%8D-what-tiny-frontend-isn-t" class="">what tiny frontend isn&#39;t</a> section, this is not something this approach is trying to solve at the moment.</p><h4 id="⛅️-ssr-doesn-t-work-in-cloudflare-workers" tabindex="-1"><a class="header-anchor" href="#⛅️-ssr-doesn-t-work-in-cloudflare-workers" aria-hidden="true">#</a> ⛅️  SSR doesn&#39;t work in Cloudflare Workers</h4><p>Sadly, Clouflare Workers doesn&#39;t provide <a href="https://developers.cloudflare.com/workers/runtime-apis/web-standards#javascript-standards" target="_blank" rel="noopener noreferrer">any way of loading JS dynamically at runtime<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. This means this approach won&#39;t work in that environment for SSR 😢 .</p><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/tiny-frontend/edit/main/docs/guide/architecture.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub"><!--[--><!--]--> Edit this page on GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: adrien@abaron.net">adrienbaron</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: adrien@abaron.net">Adrien Baron</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/guide/about.html" class="" aria-label="About tiny frontend"><!--[--><!--]--> About tiny frontend <!--[--><!--]--></a></span><span class="next"><a href="/guide/deploy.html" class="" aria-label="Deploy your own"><!--[--><!--]--> Deploy your own <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
<script type="module" src="/assets/app.ee617076.js" defer></script>
<!-- Cloudflare Web Analytics -->
<script defer src='https://static.cloudflareinsights.com/beacon.min.js'
        data-cf-beacon='{"token": "61e2706090f14213b75f6cd2e767cc9c"}'></script>
<!-- End Cloudflare Web Analytics -->
</body>
</html>
